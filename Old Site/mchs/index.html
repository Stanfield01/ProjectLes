<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="style.css" />
        <link rel="stylesheet" href="css/leaflet.css" />
        <link rel="stylesheet" href="css/qgis2web.css" />
        <link rel="stylesheet" href="css/fontawesome-all.min.css" />
        <link rel="stylesheet" href="css/leaflet-measure.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="pdf/pdfmake.min.js"></script>
        <script src="pdf/vfs_fonts.js"></script>

        <style>
            #map {
                width: inherit;
                height: 80vh;
                z-index: 4;
            }
        </style>
        <title>Моделирование ЧС</title>
    </head>

    <body onload=" weather(68.804916,33.099987)">
        <div class="sidebar">
            <div class="in_sidebar choice_bar">
                <ul>
                    <li>
                        <a href="#"
                            ><img src="images/raindrop.svg" alt="" />
                            <p>Паводки</p>
                        </a>
                    </li>
                    <li>
                        <a href="snow_index.html"
                            ><img src="images/sneg.svg" alt="" />
                            <p>Лавины</p>
                        </a>
                    </li>
                    <div class="active_choice">
                    <li>
                        <a href="fire_index.html"
                            ><img src="images/fire.svg" alt="" />
                            <p>Пожары</p>
                        </a>
                    </li>
                    </div>
                </ul>
                <a href="https://www.mchs.gov.ru/" target="_self">
                    <img
                        src="images/MCHS_logo.png"
                        class="choice_logo"
                        alt=""
                    />
                </a>
            </div>
            <div class="sb_right">
                <a href="#">
                    <div class="in_sidebar faq_bar sbr">
                        <span> Инструкция </span>
                        <div class="faq">                          
                                Работа с системой
                            </p>
                            <br />
                            <p>
                                <p>Ввод данных</p>
                            <p>
                                1. Выберите необходимую часть карты
                            </p>
                            <p>
                                2. Задайте площадь распространения пожара
                            </p>
                            <br />
                            <p>
                                Для быстрой навигации по странице нажимайте на
                                названия разделов в боковой панели (Карта,
                                Погода, GIF анимация)
                            </p>
                            <br />
                            <p>
                                Когда введены нужные данные будет просчитано предпологаемое распространение
                            </p>
                            <br />
                            <p>
                                Для изменения списка пользователей обратитесь к разработчикам
                            </p>
                        </div>
                    </div>
                </a>
                <div class="in_sidebar employee sbr">
                    <img src="images/user.svg" alt="" />
                    <div class="select_emp">
                        <input class="select__input" type="hidden" name="" />
                        <div class="select__head" id="selected_emp">
                            Выберите пользователя
                        </div>
                        <ul class="select__list" style="display: none">
                            <li class="select__item">Иван Иванов</li>
                            <li class="select__item">Егор Егоров</li>
                            <li class="select__item">Петр Петров</li>
                        </ul>
                    </div>
                </div>

                <div class="in_sidebar anchors_bar sbr">
                    <ul>
                        <li><a href="#anchor1">Карта</a></li>
                        <li><a href="#anchor2">Погода</a></li>
                    </ul>
                </div>

                <div class="in_sidebar weather-informer">
                    <table
                        cellpadding="0"
                        cellspacing="0"
                        width="158"
                        style="
                            border: solid 1px #466fd5;
                            font-family: Arial;
                            font-size: 12px;
                            background-color: #466fd5;
                        "
                    >
                        <tr>
                            <td>
                                <table
                                    width="100%"
                                    cellpadding="0"
                                    cellspacing="0"
                                >
                                    <tr>
                                        <td
                                            width="8"
                                            height="30"
                                            background="https://rp5.ru/informer/htmlinfa/topshl.png"
                                            bgcolor="#466FD5"
                                        ></td>
                                        <td
                                            width="*"
                                            align="center"
                                            background="https://rp5.ru/informer/htmlinfa/topsh.png"
                                            bgcolor="#466FD5"
                                        >
                                            <a
                                                class="changeName"
                                                style="
                                                    color: #ffffff;
                                                    font-family: Arial;
                                                    font-size: 12px;
                                                "
                                                href="http://rp5.ru/5538/ru"
                                            >
                                                <b id="townName">Мурманск</b>
                                            </a>
                                        </td>
                                        <td
                                            width="8"
                                            height="30"
                                            background="https://rp5.ru/informer/htmlinfa/topshr.png"
                                            bgcolor="#466FD5"
                                        ></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td valign="top" style="padding: 0">
                                <iframe
                                    id="frame-weather"
                                    src="https://rp5.ru/htmla.php?id=5538&lang=ru&um=00000&bg=%23466FD5&ft=%23466FD5&fc=%23466FD5&c=%23000000&f=Arial&s=12&sc=1"
                                    width="253"
                                    height="109"
                                    frameborder="0"
                                    scrolling="no"
                                    style="margin: 0"
                                >
                                </iframe>
                            </td>
                        </tr>
                    </table>
                </div>

                <button class="give_results" onclick="create_pdf()">
                    Отчет
                </button>
            </div>
        </div>

        <div class="settings" >           
            <div style="display: inline-block; width: 180px;">
                <Button onclick="addMesh()">Добавить сетку</Button>
            </div>
            <div style="display: inline-block; width: 180px;">
                <Button onclick="deleteMesh()">Удалить сетку</Button>
            </div>

            <div style="display: inline-block; width: 180px;">
                <Button onclick="prevSim()"> Назад </Button>
            </div> 
            <div style="display: inline-block; width: 180px;">
                <Button onclick="nextSim()"> Вперед </Button>
            </div> 
        </div>

        <div class="main_content">
            <div class="d2_map mc">                    
                <p class="mc_header" id="anchor1">2D КАРТА МЕСТНОСТИ</p>
                <div class="smart_map">
                    <div id="map"></div>
                    <script src="js/qgis2web_expressions.js"></script>
                    <script src="js/leaflet.js"></script>
                    <script src="js/leaflet.rotatedMarker.js"></script>
                    <script src="js/leaflet.pattern.js"></script>
                    <script src="js/Autolinker.min.js"></script>
                    <script src="js/rbush.min.js"></script>
                    <script src="js/labelgun.min.js"></script>
                    <script src="js/labels.js"></script>
                    <script src="js/leaflet-measure.js"></script>
                    <script>                                         
                        var map = new L.map('map', {
                            zoomControl: true,
                            maxZoom: 28,
                            minZoom: 1,
                        }).fitBounds([
                            [68.897683, 32.963397],
                            [68.867508, 33.128933],
                        ]);
                        var autolinker = new Autolinker({
                            truncate: {
                                length: 30,
                                location: 'smart',
                            },
                        });
                        var measureControl = new L.Control.Measure({
                            position: 'topleft',
                            primaryLengthUnit: 'meters',
                            secondaryLengthUnit: 'kilometers',
                            primaryAreaUnit: 'sqmeters',
                            secondaryAreaUnit: 'hectares',
                        });
                        
                        measureControl.addTo(map);
                        document.getElementsByClassName(
                            'leaflet-control-measure-toggle'
                        )[0].innerHTML = '';
                        document.getElementsByClassName(
                            'leaflet-control-measure-toggle'
                        )[0].className += ' fas fa-ruler';
                        var bounds_group = new L.featureGroup([]);

                        

                        function setBounds() {}
                        map.createPane('pane_OpenStreetMap_0');
                        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
                        var layer_OpenStreetMap_0 = L.tileLayer(
                            'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
                            {
                                pane: 'pane_OpenStreetMap_0',
                                opacity: 0.8,
                                attribution: '',
                                minZoom: 1,
                                maxZoom: 28,
                                minNativeZoom: 0,
                                maxNativeZoom: 19,
                            }
                        );
                        layer_OpenStreetMap_0;
                        map.addLayer(layer_OpenStreetMap_0);

                        // Создание карты

                        map.setView(new L.LatLng(68.000000, 34.589118), 7);
                        

                        var mesh_url = './datasim/0.png'; 
                        var mesh;
                        var mesh_created = false;
                        var bounds = map.getBounds();
                        var map_pixel_width = map.getPixelBounds().max.x - map.getPixelBounds().min.x;
                        var map_pixel_height = map.getPixelBounds().max.y - map.getPixelBounds().min.y;
                        var hex_radius = 30;

                        function addMesh() {
                            if (!mesh_created) {
                                bounds = map.getBounds();
                                alert(Math.round(map_pixel_height / hex_radius));
                                alert(Math.round(map_pixel_width / hex_radius));
                                mesh = L.imageOverlay(mesh_url, [bounds.getCenter(), [bounds.getNorthWest(), bounds.getSouthEast()]]).addTo(map);
                                mesh_created = true;
                            }
                        };

                        function deleteMesh() {
                            if (mesh_created) {
                                map.removeLayer(mesh);
                                mesh_created = false;
                            }
                        }

                        var current_sim = 0;

                        function prevSim() {
                            if (current_sim > 0 && mesh_created) {
                                current_sim--;
                                mesh_url = './datasim/' + current_sim.toString() + ".png";
                                map.removeLayer(mesh);
                                mesh = L.imageOverlay(mesh_url, [bounds.getCenter(), [bounds.getNorthWest(), bounds.getSouthEast()]]).addTo(map);
                            }
                        }

                        function nextSim() {
                            if (current_sim < 3 && mesh_created) {
                                current_sim++;
                                mesh_url = './datasim/' + current_sim.toString() + ".png";
                                map.removeLayer(mesh);
                                mesh = L.imageOverlay(mesh_url, [bounds.getCenter(), [bounds.getNorthWest(), bounds.getSouthEast()]]).addTo(map);
                            }
                        }                       
                    </script>
                </div>
                <hr />
                <div class="whitespace_omg"></div>
            </div>
            <div class="weather mc" style="height: 85vh">
                <p class="mc_header" id="anchor2">ПРОГНОЗ ПОГОДЫ</p>
                <hr />
                <div>&nbsp;</div>
                <div class="pricing-table row">
                    <div class="package">
                        <div></div>

                        <div class="time-actualy__title" id="col1">
                            Дни недели
                            <div class="timeActualy" id="timeActualy">
                                &nbsp; &nbsp; &nbsp;
                            </div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="degrees-days__title" id="col2">
                            Температура
                            <div class="degrees__days" id="degrees__days"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="pressure__title" id="col3">
                            Давление
                            <div class="pressure" id="pressure"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="humidity__title" id="col4">
                            Влажность
                            <div class="humidity" id="humidity"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="pop__title" id="col5">
                            Вероятность осадков
                            <div class="pop" id="pop"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="wind__title" id="col6">
                            Скорость ветра
                            <div class="wind" id="wind"></div>
                        </div>

                        <div></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <p>
                Проект разработан группой студентов МАГУ 3 курса направления
                подготовки "Информатика и вычислительная техника" <br /><br />
                &copy; 2003
                <script>
                    new Date().getFullYear() > 2003 &&
                        document.write('-' + new Date().getFullYear());
                </script>
                Мурманский арктический государственный университет
            </p>
            <a href="http://www.masu.edu.ru/" target="_blank">
                <img src="images/MASU_logo.svg" alt="" />
            </a>
        </div>
        <script src="index.js"></script>
        <script src="pdf/pdf.js"></script>
        <script id="weathertown" src="assets/imgs/Варзуга/index.js"></script>
    </body>
</html>
