<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="style.css" />
        <link rel="stylesheet" href="css/leaflet.css" />
        <link rel="stylesheet" href="css/qgis2web.css" />
        <link rel="stylesheet" href="css/fontawesome-all.min.css" />
        <link rel="stylesheet" href="css/leaflet-measure.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="pdf/pdfmake.min.js"></script>
        <script src="pdf/vfs_fonts.js"></script>

        <!-- <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Varela" /> -->
        <style>
            #map {
                width: inherit;
                height: 80vh;
                z-index: 4;
            }
        </style>
        <title>Моделирование ЧС</title>
    </head>

    <body onload=" weather(68.804916,33.099987)">
        <div class="sidebar">
            <div class="in_sidebar choice_bar">
                <ul>
                    <li>
                        <a href="#"
                            ><img src="images/raindrop.svg" alt="" />
                            <p>Паводки</p>
                        </a>
                    </li>
                    <li>
                        <a href="snow_index.html"
                            ><img src="images/sneg.svg" alt="" />
                            <p>Лавины</p>
                        </a>
                    </li>
                    <div class="active_choice">
                    <li>
                        <a href="fire_index.html"
                            ><img src="images/fire.svg" alt="" />
                            <p>Пожары</p>
                        </a>
                    </li>
                    </div>
                </ul>
                <a href="https://www.mchs.gov.ru/" target="_self">
                    <img
                        src="images/MCHS_logo.png"
                        class="choice_logo"
                        alt=""
                    />
                </a>
            </div>
            <div class="sb_right">
                <a href="#">
                    <div class="in_sidebar faq_bar sbr">
                        <!-- <div style="float: left; width: 250px;" data-tooltip2='1. Выберите населенный пункт, нажимая на соответствующую форму ввода на верхней панели и на название н.п.
                            2. Измените уровень подтопления, нажимая на стрелочки в правой части формы ввода на верхней панели
                            
                            Для быстрой навигации по странице нажимайте на названия разделов в боковой панели (Карта, Погода, GIF анимация)
                            
                            Для открытия 3D модели подтопления нажмите на красную кнопку "Интерактивная 3D модель" на верхней панели. Обратите внимание на предупреждение о загрузке большого объема данных
                            
                            Когда введены нужные данные, для формирования отчета нажмите кнопку "Отчет" в нижней части боковой панели
                        '> -->
                        <span> Инструкция </span>
                        <!-- </div> -->
                        <!-- <div onclick="" class="hidden_faq"> -->
                        <div class="faq">
                          
                                Работа с системой
                            </p>
                            <br />
                            <p>
                                  <p>Ввод данных</p>
                            <p>
                                1. Выберите необходимую часть карты
                            </p>
                            <p>
                                2. Задайте площадь распространения пожара
                            </p>
                            <br />
                            <p>
                                Для быстрой навигации по странице нажимайте на
                                названия разделов в боковой панели (Карта,
                                Погода, GIF анимация)
                            </p>
                            <br />
                            <p>
                                Когда введены нужные данные будет просчитано предпологаемое распространение
                            </p>
                            <br />
                            <p>
                                Для изменения списка пользователей обратитесь к разработчикам
                            </p>
                        </div>
                    </div>
                </a>
                <div class="in_sidebar employee sbr">
                    <img src="images/user.svg" alt="" />
                    <div class="select_emp">
                        <input class="select__input" type="hidden" name="" />
                        <div class="select__head" id="selected_emp">
                            Выберите пользователя
                        </div>
                        <ul class="select__list" style="display: none">
                            <li class="select__item">Иван Иванов</li>
                            <li class="select__item">Егор Егоров</li>
                            <li class="select__item">Петр Петров</li>
                        </ul>
                    </div>
                </div>

                <div class="in_sidebar anchors_bar sbr">
                    <ul>
                        <li><a href="#anchor1">Карта</a></li>
                        <li><a href="#anchor2">Погода</a></li>
                    </ul>
                </div>

                <div class="in_sidebar weather-informer">
                    <table
                        cellpadding="0"
                        cellspacing="0"
                        width="158"
                        style="
                            border: solid 1px #466fd5;
                            font-family: Arial;
                            font-size: 12px;
                            background-color: #466fd5;
                        "
                    >
                        <tr>
                            <td>
                                <table
                                    width="100%"
                                    cellpadding="0"
                                    cellspacing="0"
                                >
                                    <tr>
                                        <td
                                            width="8"
                                            height="30"
                                            background="https://rp5.ru/informer/htmlinfa/topshl.png"
                                            bgcolor="#466FD5"
                                        ></td>
                                        <td
                                            width="*"
                                            align="center"
                                            background="https://rp5.ru/informer/htmlinfa/topsh.png"
                                            bgcolor="#466FD5"
                                        >
                                            <a
                                                class="changeName"
                                                style="
                                                    color: #ffffff;
                                                    font-family: Arial;
                                                    font-size: 12px;
                                                "
                                                href="https://rp5.ru/2005/ru"
                                            >
                                                <b id="townName">Варзуга</b>
                                            </a>
                                        </td>
                                        <td
                                            width="8"
                                            height="30"
                                            background="https://rp5.ru/informer/htmlinfa/topshr.png"
                                            bgcolor="#466FD5"
                                        ></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td valign="top" style="padding: 0">
                                <iframe
                                    id="frame-weather"
                                    src="https://rp5.ru/htmla.php?id=2005&lang=ru&um=00000&bg=%23466FD5&ft=%23466FD5&fc=%23466FD5&c=%23000000&f=Arial&s=12&sc=1"
                                    width="253"
                                    height="109"
                                    frameborder="0"
                                    scrolling="no"
                                    style="margin: 0"
                                >
                                </iframe>
                            </td>
                        </tr>
                    </table>
                </div>

                <button class="give_results" onclick="create_pdf()">
                    Отчет
                </button>
            </div>
        </div>

        

        <div class="main_content">
            <div class="d2_map mc">
                <p class="mc_header" id="anchor1">2D КАРТА МЕСТНОСТИ</p>
                <div class="smart_map">
                    <div id="map"></div>
                    <script src="js/qgis2web_expressions.js"></script>
                    <script src="js/leaflet.js"></script>
                    <script src="js/leaflet.rotatedMarker.js"></script>
                    <script src="js/leaflet.pattern.js"></script>
                    <script src="js/leaflet-hash.js"></script>
                    <script src="js/Autolinker.min.js"></script>
                    <script src="js/rbush.min.js"></script>
                    <script src="js/labelgun.min.js"></script>
                    <script src="js/labels.js"></script>
                    <script src="js/leaflet-measure.js"></script>
                    <script>
                        var highlightLayer;

                        function highlightFeature(e) {
                            highlightLayer = e.target;

                            if (
                                e.target.feature.geometry.type === 'LineString'
                            ) {
                                highlightLayer.setStyle({
                                    color: '#ffff00',
                                });
                            } else {
                                highlightLayer.setStyle({
                                    fillColor: '#ffff00',
                                    fillOpacity: 1,
                                });
                            }
                        }

                        var map = new L.map('map', {
                            zoomControl: true,
                            maxZoom: 28,
                            minZoom: 1,
                        }).fitBounds([
                            [68.897683, 32.963397],
                            [68.867508, 33.128933],
                        ]);
                        var hash = new L.Hash(map);
                        map.attributionControl.setPrefix(
                            '<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>'
                        );
                        var autolinker = new Autolinker({
                            truncate: {
                                length: 30,
                                location: 'smart',
                            },
                        });
                        var measureControl = new L.Control.Measure({
                            position: 'topleft',
                            primaryLengthUnit: 'meters',
                            secondaryLengthUnit: 'kilometers',
                            primaryAreaUnit: 'sqmeters',
                            secondaryAreaUnit: 'hectares',
                        });
                        measureControl.addTo(map);
                        document.getElementsByClassName(
                            'leaflet-control-measure-toggle'
                        )[0].innerHTML = '';
                        document.getElementsByClassName(
                            'leaflet-control-measure-toggle'
                        )[0].className += ' fas fa-ruler';
                        var bounds_group = new L.featureGroup([]);

                        function setBounds() {}
                        map.createPane('pane_OpenStreetMap_0');
                        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
                        var layer_OpenStreetMap_0 = L.tileLayer(
                            'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
                            {
                                pane: 'pane_OpenStreetMap_0',
                                opacity: 1.0,
                                attribution: '',
                                minZoom: 1,
                                maxZoom: 28,
                                minNativeZoom: 0,
                                maxNativeZoom: 19,
                            }
                        );
                        layer_OpenStreetMap_0;
                        map.addLayer(layer_OpenStreetMap_0);


                        map.createPane('pane_varz10');
                        map.getPane('pane_varz10').style.zIndex = 407;
                        var img_varz10 = 'data/varz/varz1.png';
                        var img_bounds_varz10 = [
                            [66.38875, 36.54792],
                            [66.41708, 36.63292],
                        ];
                        var layer_water = new L.imageOverlay(
                            img_varz10,
                            img_bounds_varz10,
                            {
                                pane: 'pane_varz10',
                            }
                        );
                        bounds_group.addLayer(layer_water);
                        map.addLayer(layer_water);

                        // Создание карты

                        map.setView(new L.LatLng(68.000000, 34.589118), 6);

                        let coords = {
                            kild: [
                                [68.79042, 33.07042],
                                [68.81542, 33.13792],
                                '14',
                            ],
                            varz: [
                                [66.38875, 36.54792],
                                [66.41708, 36.63292],
                                '7',
                            ],
                            rev: [
                                [67.91958, 34.46792],
                                [67.97125, 34.62542],
                                '7',
                            ],
                            rst: [
                                [69.00625, 33.00125],
                                [69.03792, 33.10125],
                                '12',
                            ],
                            kola: [
                                [68.87292, 32.99125],
                                [68.90042, 33.06875],
                                '3',
                            ],
                            magn: [
                                [68.67708, 33.11042],
                                [68.69292, 33.15042],
                                '12',
                            ],
                        };
                        // for (key in coords) {
                        //     map.createPane('frame');
                        //     map.getPane('frame').style.zIndex = 407;
                        //     var img_frame = 'data/' + key + '/frame.png';
                        //     var img_bounds_frame = [
                        //         coords[key][0],
                        //         coords[key][1],
                        //     ];
                        //     var layer_frame = new L.imageOverlay(
                        //         img_frame,
                        //         img_bounds_frame,
                        //         {
                        //             pane: 'frame',
                        //         }
                        //     );
                        //     map.addLayer(layer_frame);

                        //     for (var j = 1; j <= coords[key][2]; j++) {
                        //         // alert (key+j)
                        //         // alert ("data/"+key+"/"+key+j+'.png')
                        //         localStorage.setItem(
                        //             key + j,
                        //             'data/' + key + '/' + key + j + '.png'
                        //         );
                        //     }
                        // }
                        function setvalues() {
                            document.querySelector('.inputdata__high').value =
                                '0';
                            document
                                .querySelector('.inputdata__town')
                                .getElementsByTagName(
                                    'option'
                                )[0].selected = true;
                        }

                        function changemap() {
                            (lat =
                                Math.floor(
                                    document.getElementById('town').options[
                                        document.getElementById('town').options
                                            .selectedIndex
                                    ].value
                                ) / 1000000),
                                Math.floor(
                                    document.getElementById('town').options[
                                        document.getElementById('town').options
                                            .selectedIndex
                                    ].value
                                ) -
                                    Math.floor(
                                        document.getElementById('town').options[
                                            document.getElementById('town')
                                                .options.selectedIndex
                                        ].value
                                    ) /
                                        1000000;
                            lon =
                                (document.getElementById('town').options[
                                    document.getElementById('town').options
                                        .selectedIndex
                                ].value -
                                    Math.floor(
                                        document.getElementById('town').options[
                                            document.getElementById('town')
                                                .options.selectedIndex
                                        ].value
                                    )) *
                                100;
                            weather(lat, lon);
                            var baseMaps = {
                                OpenStreetMap: layer_OpenStreetMap_0,
                                frame: layer_frame,
                            };


                            town =
                                document.getElementById('town').options[
                                    document.getElementById('town')
                                        .selectedIndex
                                ].text;
                            localStorage.setItem('town', town);
                            document.querySelector('.inputdata__high').value =
                                '0';
                            document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'assets/gifs/' + town + '.gif'
                                );
                            if (town == 'Кола') {
                                document
                                    .querySelector('.inputdata__high')
                                    .setAttribute('max', coords['kola'][2]);
                                map.setView(new L.LatLng(68.8851, 33.0305), 14);
                            } else if (town == 'Роста') {
                                document
                                    .querySelector('.inputdata__high')
                                    .setAttribute('max', coords['rst'][2]);
                                map.setView(
                                    new L.LatLng(69.015204, 33.077945),
                                    14
                                );
                            } else if (town == 'Ревда') {
                                document
                                    .querySelector('.inputdata__high')
                                    .setAttribute('max', coords['rev'][2]);
                                map.setView(
                                    new L.LatLng(67.942206, 34.553401),
                                    12
                                );
                            } else if (town == 'Кильдинстрой') {
                                document
                                    .querySelector('.inputdata__high')
                                    .setAttribute('max', coords['kild'][2]);
                                map.setView(
                                    new L.LatLng(68.804565, 33.098831),
                                    14
                                );
                            } else if (town == 'Магнетиты') {
                                document
                                    .querySelector('.inputdata__high')
                                    .setAttribute('max', coords['magn'][2]);
                                map.setView(
                                    new L.LatLng(68.686106, 33.12737),
                                    14
                                );
                            } else if (town == 'Варзуга') {
                                document
                                    .querySelector('.inputdata__high')
                                    .setAttribute('max', coords['varz'][2]);
                                map.setView(
                                    new L.LatLng(66.395363, 36.589118),
                                    14
                                );
                            }
                        }

                        function changewater() {
                            this.map.removeLayer(this.layer_water);

                            town =
                                document.getElementById('town').options[
                                    document.getElementById('town')
                                        .selectedIndex
                                ].text;
                            water = document.getElementById('high').value;
                            
                            if (water != 0) {
                                if (town == 'Кола') {
                                    townen = 'kola';
                                    map.createPane(
                                        'pane_' + townen + '_' + water
                                    );
                                    map.getPane(
                                        'pane_' + townen + '_' + water
                                    ).style.zIndex = 401;
                                    // var img_water = 'data/' + townen + '/' + townen + '' + water + '.png';
                                    var img_water = localStorage.getItem(
                                        townen + water
                                    );
                                    var img_bounds_water = [
                                        coords[townen][0],
                                        coords[townen][1],
                                    ];
                                    layer_water = new L.imageOverlay(
                                        img_water,
                                        img_bounds_water,
                                        {
                                            pane:
                                                'pane_' + townen + '_' + water,
                                        }
                                    );
                                    bounds_group.addLayer(layer_water);
                                    map.addLayer(layer_water);
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/kol_gif/kol_' + water + '.gif'
                                );

                                
                                } else if (town == 'Роста') {
                                    townen = 'rst';
                                    map.createPane(
                                        'pane_' + townen + '_' + water
                                    );
                                    map.getPane(
                                        'pane_' + townen + '_' + water
                                    ).style.zIndex = 401;
                                    // var img_water = 'data/' + townen + '/' + townen + '' + water + '.png';
                                    var img_water = localStorage.getItem(
                                        townen + water
                                    );
                                    var img_bounds_water = [
                                        coords[townen][0],
                                        coords[townen][1],
                                    ];
                                    layer_water = new L.imageOverlay(
                                        img_water,
                                        img_bounds_water,
                                        {
                                            pane:
                                                'pane_' + townen + '_' + water,
                                        }
                                    );
                                    bounds_group.addLayer(layer_water);
                                    map.addLayer(layer_water);

                                    
                                } else if (town == 'Ревда') {
                                    townen = 'rev';
                                    map.createPane(
                                        'pane_' + townen + '_' + water
                                    );
                                    map.getPane(
                                        'pane_' + townen + '_' + water
                                    ).style.zIndex = 401;
                                    var img_water = localStorage.getItem(
                                        townen + water
                                    );
                                    var img_bounds_water = [
                                        coords[townen][0],
                                        coords[townen][1],
                                    ];
                                    layer_water = new L.imageOverlay(
                                        img_water,
                                        img_bounds_water,
                                        {
                                            pane:
                                                'pane_' + townen + '_' + water,
                                        }
                                    );
                                    bounds_group.addLayer(layer_water);
                                    map.addLayer(layer_water);


                                } else if (town == 'Кильдинстрой') {
                                    townen = 'kild';
                                    map.createPane(
                                        'pane_' + townen + '_' + water
                                    );
                                    map.getPane(
                                        'pane_' + townen + '_' + water
                                    ).style.zIndex = 401;
                                    var img_water = localStorage.getItem(
                                        townen + water
                                    );
                                    var img_bounds_water = [
                                        coords[townen][0],
                                        coords[townen][1],
                                    ];
                                    layer_water = new L.imageOverlay(
                                        img_water,
                                        img_bounds_water,
                                        {
                                            pane:
                                                'pane_' + townen + '_' + water,
                                        }
                                    );
                                    bounds_group.addLayer(layer_water);
                                    map.addLayer(layer_water);
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/kil_gif/kil_' + water + '.gif'
                                );


                                } else if (town == 'Магнетиты') {
                                    townen = 'magn';
                                    map.createPane(
                                        'pane_' + townen + '_' + water
                                    );
                                    map.getPane(
                                        'pane_' + townen + '_' + water
                                    ).style.zIndex = 401;
                                    var img_water = localStorage.getItem(
                                        townen + water
                                    );
                                    var img_bounds_water = [
                                        coords[townen][0],
                                        coords[townen][1],
                                    ];
                                    layer_water = new L.imageOverlay(
                                        img_water,
                                        img_bounds_water,
                                        {
                                            pane:
                                                'pane_' + townen + '_' + water,
                                        }
                                    );
                                    bounds_group.addLayer(layer_water);
                                    map.addLayer(layer_water);
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/mag_gif/mag_' + water + '.gif'
                                );


                                } else if (town == 'Варзуга') {
                                    townen = 'varz';
                                    map.createPane(
                                        'pane_' + townen + '_' + water
                                    );
                                    map.getPane(
                                        'pane_' + townen + '_' + water
                                    ).style.zIndex = 401;
                                    var img_water = localStorage.getItem(
                                        townen + water
                                    );
                                    var img_bounds_water = [
                                        coords[townen][0],
                                        coords[townen][1],
                                    ];
                                    layer_water = new L.imageOverlay(
                                        img_water,
                                        img_bounds_water,
                                        {
                                            pane:
                                                'pane_' + townen + '_' + water,
                                        }
                                    );
                                    bounds_group.addLayer(layer_water);
                                    map.addLayer(layer_water);
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/var_gif/var_' + water + '.gif'
                                );
                                }
                            }


                            if (water == 0) {

                                if (town == 'Кола') {
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/kol_gif/kol_0.gif'
                                );


                                } else if (town == 'Кильдинстрой') {
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/kil_gif/kil_0.gif'
                                );


                                } else if (town == 'Магнетиты') {
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/mag_gif/mag_0.gif'
                                );


                                } else if (town == 'Варзуга') {
                                    
                                    document
                                .querySelector('#giff')
                                .setAttribute(
                                    'src',
                                    'gifs/var_gif/var_0.gif'
                                );
                                }
                            }
                        }
                    </script>
                </div>
                <hr />
                <div class="whitespace_omg"></div>
            </div>
            <div class="weather mc" style="height: 85vh">
                <p class="mc_header" id="anchor2">ПРОГНОЗ ПОГОДЫ</p>
                <hr />
                <div>&nbsp;</div>
                <div class="pricing-table row">
                    <div class="package">
                        <div></div>

                        <div class="time-actualy__title" id="col1">
                            Дни недели
                            <div class="timeActualy" id="timeActualy">
                                &nbsp; &nbsp; &nbsp;
                            </div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="degrees-days__title" id="col2">
                            Температура
                            <div class="degrees__days" id="degrees__days"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="pressure__title" id="col3">
                            Давление
                            <div class="pressure" id="pressure"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="humidity__title" id="col4">
                            Влажность
                            <div class="humidity" id="humidity"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="pop__title" id="col5">
                            Вероятность осадков
                            <div class="pop" id="pop"></div>
                        </div>

                        <div>&nbsp; &nbsp; &nbsp;</div>

                        <div class="wind__title" id="col6">
                            Скорость ветра
                            <div class="wind" id="wind"></div>
                        </div>

                        <div></div>
                    </div>
                </div>
                <a title="с. Варзуга">
                    <script>
                        document.write(
                            "<img border='0' src='http://gis.vodinfo.ru/informer/draw/v2_71186_400_200_30_ffffff_110_8_6_H_none.png?" +
                                Math.floor(100000 * Math.random()) +
                                "' width='400px' height='200px' >"
                        );
                    </script>
                </a>
                <a title="График поста 1429-ый км Октябрьской ж.д. на р. Кола">
                    <script>
                        document.write(
                            "<img border='0' src='http://gis.vodinfo.ru/informer/draw/v2_71104_250_200_30_ffffff_110_8_6_H_none.png?" +
                                Math.floor(100000 * Math.random()) +
                                "' width='250px' height='200px' >"
                        );
                    </script>
                </a>
            </div>
        </div>
        <div class="footer">
            <p>
                Проект разработан группой студентов МАГУ 3 курса направления
                подготовки "Прикладная математика и информатика" <br /><br />
                &copy; 2003
                <script>
                    new Date().getFullYear() > 2003 &&
                        document.write('-' + new Date().getFullYear());
                </script>
                Мурманский арктический государственный университет
            </p>
            <a href="http://www.masu.edu.ru/" target="_blank">
                <img src="images/MASU_logo.svg" alt="" />
            </a>
        </div>
        <script src="index.js"></script>
        <script src="pdf/pdf.js"></script>
        <script id="weathertown" src="assets/imgs/Варзуга/index.js"></script>
    </body>
</html>
